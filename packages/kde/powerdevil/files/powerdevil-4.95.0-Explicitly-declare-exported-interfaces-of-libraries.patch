Upstream: yes

From 049113e719dd2fc4446d054fa1a3aada330094f0 Mon Sep 17 00:00:00 2001
From: Alex Merry <alex.merry@kde.org>
Date: Sat, 29 Mar 2014 12:10:23 +0000
Subject: [PATCH 2/2] Explicitly declare exported interfaces of libraries

This is (a) generally a good idea, and (b) necessary with CMake
2.8.12.0, which defaults to PRIVATE linkage (when CMP0022 is NEW) if no
keywords are given to target_link_libraries().
---
 powerdevil/daemon/CMakeLists.txt          | 21 ++++++++++++++-------
 powerdevil/daemon/powerdevilaction.h      |  2 --
 powerdevil/kcmodule/common/CMakeLists.txt |  7 ++++---
 3 files changed, 18 insertions(+), 12 deletions(-)

diff --git a/powerdevil/daemon/CMakeLists.txt b/powerdevil/daemon/CMakeLists.txt
index 1dac903..6ba950f 100644
--- a/powerdevil/daemon/CMakeLists.txt
+++ b/powerdevil/daemon/CMakeLists.txt
@@ -46,12 +46,14 @@ qt5_add_dbus_adaptor(powerdevilcore_SRCS actions/bundled/org.kde.Solid.PowerMana
 add_library(powerdevilcore SHARED ${powerdevilcore_SRCS} ${powerdevil_bundled_actions_SRCS})
 set_target_properties(powerdevilcore PROPERTIES VERSION ${POWERDEVIL_CORE_VERSION_STRING} SOVERSION ${POWERDEVIL_CORE_VERSION_MAJOR})
 
+# not exported, so just make the deps public
 target_link_libraries(powerdevilcore
-    KF5::KDE4Support
-    KF5::Solid
-    KF5::IdleTime
-    KF5::GlobalAccel
-    PW::KWorkspace
+    PUBLIC
+        KF5::KDE4Support
+        KF5::Solid
+        KF5::IdleTime
+        KF5::GlobalAccel
+        PW::KWorkspace
 )
 
 # target no.2 - powerdevil kded module
@@ -82,6 +84,9 @@ target_link_libraries(kded_powerdevil
     KF5::DBusAddons
     powerdevilcore
 )
+if (X11_FOUND)
+    target_link_libraries(kded_powerdevil Qt5::X11Extras)
+endif ()
 
 if (UDEV_FOUND)
     target_link_libraries(kded_powerdevil ${UDEV_LIBS})
@@ -98,9 +103,11 @@ set(powerdevilui_SRCS
 add_library(powerdevilui ${powerdevilui_SRCS})
 set_target_properties(powerdevilui PROPERTIES VERSION ${GENERIC_LIB_VERSION} SOVERSION ${GENERIC_LIB_SOVERSION} )
 
+# not exported, so just make the deps public
 target_link_libraries(powerdevilui
-    Qt5::Widgets
-    KF5::ConfigCore
+    PUBLIC
+        Qt5::Widgets
+        KF5::ConfigCore
 )
 
 set(HAVE_UDEV ${UDEV_FOUND})
diff --git a/powerdevil/daemon/powerdevilaction.h b/powerdevil/daemon/powerdevilaction.h
index 5d4be5c..8629e73 100644
--- a/powerdevil/daemon/powerdevilaction.h
+++ b/powerdevil/daemon/powerdevilaction.h
@@ -26,8 +26,6 @@
 #include <QtCore/QObject>
 #include <QtCore/QVariantMap>
 
-#include <kdemacros.h>
-
 class KConfigGroup;
 
 namespace PowerDevil
diff --git a/powerdevil/kcmodule/common/CMakeLists.txt b/powerdevil/kcmodule/common/CMakeLists.txt
index 0a8d9b8..d978050 100644
--- a/powerdevil/kcmodule/common/CMakeLists.txt
+++ b/powerdevil/kcmodule/common/CMakeLists.txt
@@ -7,10 +7,11 @@ set( powerdevil_config_common_private_SRCS
 
 add_library(powerdevilconfigcommonprivate SHARED ${powerdevil_config_common_private_SRCS})
 
+# not exported, so just make the links public
 target_link_libraries(powerdevilconfigcommonprivate
-     
-     powerdevilcore
-     powerdevilui
+    PUBLIC
+        powerdevilcore
+        powerdevilui
 )
 
 set_target_properties(powerdevilconfigcommonprivate PROPERTIES VERSION ${GENERIC_LIB_VERSION} SOVERSION ${GENERIC_LIB_SOVERSION})
-- 
1.9.1

