Upstream: Yes (pending)
Source: Daniel Mierswa <impulze@impulze.org>
Reason: do not hardcode usb.ids path

See http://bugs.kde.org/show_bug.cgi?id=175104

Index: apps/ConfigureChecks.cmake
===================================================================
--- ./apps/ConfigureChecks.cmake	(revision 884035)
+++ ./apps/ConfigureChecks.cmake	(working copy)
@@ -8,5 +8,16 @@ include(CheckStructMember)
 include(CheckTypeSize)
 include(CheckCXXSourceCompiles)
 
+if ( KDE_USBIDS_DIR )
+		if ( IS_DIRECTORY KDE_USBIDS_DIR AND IS_ABSOLUTE KDE_USBIDS_DIR )
+			MESSAGE( SEND_ERROR "${KDE_USB_DIR} is not a directory or absolute" )
+		endif ( IS_DIRECTORY KDE_USBIDS_DIR AND IS_ABSOLUTE KDE_USBIDS_DIR )
+		SET( KDE_USBIDS "${KDE_USBIDS_DIR}/usb.ids" )
+else ( KDE_USBIDS_DIR )
+	SET( KDE_USBIDS "/usr/share/hwdata/usb.ids" ) # on fedora
+endif ( KDE_USBIDS_DIR )
+
+MESSAGE( STATUS "${KDE_USBIDS} will be used as usb device database" )
+
 check_function_exists(getpeereid  HAVE_GETPEEREID) # kdesu
 check_function_exists(statvfs HAVE_STATVFS) # kinfocenter
Index: apps/kinfocenter/usbview/usbdb.cpp
===================================================================
--- ./apps/kinfocenter/usbview/usbdb.cpp	(revision 884035)
+++ ./apps/kinfocenter/usbview/usbdb.cpp	(working copy)
@@ -19,8 +19,10 @@

 #include <kstandarddirs.h>

+#include <config-apps.h>
+
 USBDB::USBDB() {
-	QString db = "/usr/share/hwdata/usb.ids"; /* on Fedora */
+	QString db = KDE_USBIDS;
	if (!QFile::exists(db))
		db = KStandardDirs::locate("data", "kcmusb/usb.ids");
	if (db.isEmpty())
Index: apps/kinfocenter/usbview/CMakeLists.txt
===================================================================
--- ./apps/kinfocenter/usbview/CMakeLists.txt	(revision 884035)
+++ ./apps/kinfocenter/usbview/CMakeLists.txt	(working copy)
@@ -17,4 +17,6 @@ install(TARGETS kcm_usb  DESTINATION ${PLUGIN_INST
 ########### install files ###############
 
 install( FILES kcmusb.desktop  DESTINATION  ${SERVICES_INSTALL_DIR} )
-install( FILES usb.ids  DESTINATION  ${DATA_INSTALL_DIR}/kcmusb )
+if ( NOT DISABLE_USBIDS_INSTALL )
+	install( FILES usb.ids  DESTINATION  ${DATA_INSTALL_DIR}/kcmusb )
+endif ( NOT DISABLE_USBIDS_INSTALL )
Index: apps/config-apps.h.cmake
===================================================================
--- ./apps/config-apps.h.cmake	(revision 884035)
+++ ./apps/config-apps.h.cmake	(working copy)
@@ -78,6 +78,9 @@
 /* KDE's static data directory */
 #define KDE_DATADIR "${DATA_INSTALL_DIR}"
 
+/* path to usb.ids database */
+#define KDE_USBIDS "${KDE_USBIDS}"
+
 /* Define where your java executable is */
 #undef PATH_JAVA
 
