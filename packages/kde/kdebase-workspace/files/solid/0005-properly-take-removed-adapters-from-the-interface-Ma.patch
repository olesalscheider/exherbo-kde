From 44d3ca098bbace84df65346510348310386d28d0 Mon Sep 17 00:00:00 2001
From: tpatzig <tpatzig@283d02a7-25f6-0310-bc7c-ecb5cbfe19da>
Date: Fri, 16 Jan 2009 13:56:56 +0000
Subject: [PATCH] properly take removed adapters from the interface Map

git-svn-id: svn://anonsvn.kde.org/home/kde/trunk/KDE/kdebase@912006 283d02a7-25f6-0310-bc7c-ecb5cbfe19da
---
 workspace/solid/bluez/bluez-bluetoothmanager.cpp |   11 +++++++++++
 workspace/solid/bluez/bluez-bluetoothmanager.h   |    1 +
 2 files changed, 12 insertions(+), 0 deletions(-)

diff --git a/workspace/solid/bluez/bluez-bluetoothmanager.cpp b/workspace/solid/bluez/bluez-bluetoothmanager.cpp
index f14cc7b..e02cf7e 100644
--- a/workspace/solid/bluez/bluez-bluetoothmanager.cpp
+++ b/workspace/solid/bluez/bluez-bluetoothmanager.cpp
@@ -104,6 +104,7 @@ QStringList BluezBluetoothManager::bluetoothInterfaces() const
 
 QString BluezBluetoothManager::defaultInterface() const
 {
+    kDebug() << "Calling Backend Default Interface";
     QDBusReply< QDBusObjectPath > path = d->manager.call("DefaultAdapter");
     if (!path.isValid())
         return QString();
@@ -132,6 +133,16 @@ QObject * BluezBluetoothManager::createInterface(const QString  & ubi)
     return bluetoothInterface;
 }
 
+void BluezBluetoothManager::removeInterface(const QString& ubi)
+{
+
+    if (d->interfaces.contains(ubi)) {
+        kDebug() << "Removing Interface" << ubi;
+        BluezBluetoothInterface * bluetoothInterface = d->interfaces.take(ubi);
+        bluetoothInterface = 0;
+    }
+}
+
 /*
 KJob *BluezBluetoothManager::setupInputDevice(const QString &ubi)
 {
diff --git a/workspace/solid/bluez/bluez-bluetoothmanager.h b/workspace/solid/bluez/bluez-bluetoothmanager.h
index e49e6d1..380059a 100644
--- a/workspace/solid/bluez/bluez-bluetoothmanager.h
+++ b/workspace/solid/bluez/bluez-bluetoothmanager.h
@@ -43,6 +43,7 @@ public:
     virtual ~BluezBluetoothManager();
     QStringList bluetoothInterfaces() const;
     QObject * createInterface(const QString &);
+    void removeInterface(const QString& ubi);
 //  QStringList bluetoothInputDevices() const;
     QString defaultInterface() const;
     QString findInterface(const QString &) const;
-- 
1.6.1

