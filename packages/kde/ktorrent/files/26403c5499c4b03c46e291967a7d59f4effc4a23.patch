From 26403c5499c4b03c46e291967a7d59f4effc4a23 Mon Sep 17 00:00:00 2001
Message-Id: <26403c5499c4b03c46e291967a7d59f4effc4a23.1359473002.git.alip@exherbo.org>
From: Joris Guisson <joris.guisson@gmail.com>
Date: Sat, 20 Oct 2012 12:49:32 +0200
Subject: [PATCH] Backport to 4.3: First check for missing files then for
 unmounted storage
Organization: Pink Floyd

CCBUG: 308638
---
 ChangeLog         | 1 +
 ktorrent/core.cpp | 8 ++++----
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/ktorrent/core.cpp b/ktorrent/core.cpp
index 9d76bb0..12384f0 100644
--- a/ktorrent/core.cpp
+++ b/ktorrent/core.cpp
@@ -1206,6 +1206,10 @@ namespace kt
 
 	bool Core::checkMissingFiles(TorrentInterface* tc)
 	{
+        QStringList missing;
+        if(!tc->hasMissingFiles(missing))
+            return true;
+        
 		QStringList not_mounted;
 		while(!tc->isStorageMounted(not_mounted))
 		{
@@ -1226,10 +1230,6 @@ namespace kt
 			}
 		}
 
-		QStringList missing;
-		if(!tc->hasMissingFiles(missing))
-			return true;
-
 		if(tc->getStats().multi_file_torrent)
 		{
 			QString msg = i18n(
-- 
1.8.1.1

