# Copyright 2009 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require multilib

SUMMARY="A high-performance object-relational SQL database"
DESCRIPTION="
Virtuoso is a scalable cross-platform server that combines SQL/RDF/XML
Data Management with Web Application Server and Web Services Platform
functionality.
"
HOMEPAGE="http://www.openlinksw.com/borislav/wiki/Main/VOSMake http://virtuoso.sf.net/"
REMOTE_IDS="sourceforge:virtuoso"
DOWNLOADS="mirror://sourceforge/virtuoso/${PNV}.tar.gz"

LICENCES="GPL-2"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

RESTRICT="test"

# build: htmldoc for pdf docs
DEPENDENCIES="
    build+run:
        dev-libs/libxml2[>=2.4.0]
        dev-libs/openssl
        media-gfx/ImageMagick
"


DEFAULT_SRC_CONFIGURE_PARAMS=(
    --with-layout=Gentoo
    --localstatedir=/var

    --enable-shared
    # FIXME Needs an internal header of zlib (zutil.h)
    # http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=508048#44
    # --without-internal-zlib

    --program-transform-name='s/isql[-]*\(w\)*/isql\1-vt/'

    --enable-imagemagick
    --enable-openssl
    --with-readline

    # installed by default but they're huge (an extra 110MB), unnecessary for soprano, they break parallel make
    --disable-all-vads
    # upstream enables these by default
    --disable-hslookup
    --disable-wbxml2

    # Don't build virtuoso-iodbc-t because soprano/nepomuk doesn't need it
    # Currently virtuoso fails to find system libiodbc correctly
    --without-iodbc

    # we don't immediately need these
    --disable-krb
    --disable-openldap
    --disable-rendezvous
    # hosting
    --disable-{mono,php5,perl,python,ruby}
    --without-jdk{1,2,3,4}
)

src_install() {
    default

    rmdir "${IMAGE}"/usr/share/virtuoso/{vad/,} || die "Empty directories"
    rm -r "${IMAGE}"/usr/$(get_libdir)/{jdbc-*,jena,sesame}/{*.jar,} || die "One man no jars!"
}

