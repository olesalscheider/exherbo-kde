Source: Debian, http://patch-tracking.debian.net/patch/series/view/amarok/2.0.60+svn935422-2/03_mysqle_link_to_amarok_executable.diff
Slightly altered to work on Exherbo
Upstream: No
Reason: Link libmysqle statically in /usr/bin/amarok. This works on all arches, without the need for a shared libmysqle, or -fPIC hackery

From 8baa838f184fa8a2f3046ac95d2eef9187a0c7af Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Kim=20H=C3=B8jgaard-Hansen?= <kimrhh@exherbo.org>
Date: Mon, 16 Aug 2010 22:30:31 +0200
Subject: [PATCH] Link libmysqle statically

---
 src/CMakeLists.txt                                 |   13 +++++++++++++
 .../sqlcollection/mysqlecollection/CMakeLists.txt  |   10 +++-------
 2 files changed, 16 insertions(+), 7 deletions(-)

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index ea5d155..d311d3a 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -887,6 +887,19 @@ if(Q_WS_MAC)
 else(Q_WS_MAC)
     kde4_add_executable(amarok ${amarok_SRCS})
     target_link_libraries(amarok ${KDE4_KDEUI_LIBS} amaroklib ${TAGLIB_LIBRARIES} ${TAGLIB-EXTRAS_LIBRARIES} )
+    # Link MySQLe to the executable. Hence -fPIC for libmysqld is not
+    # needed anymore.
+
+    STRING(REPLACE "-Wl,--no-undefined" "" CMAKE_MODULE_LINKER_FLAGS_ALLOW_UNDEFINED ${CMAKE_MODULE_LINKER_FLAGS})
+    SET(CMAKE_MODULE_LINKER_FLAGS ${CMAKE_MODULE_LINKER_FLAGS_ALLOW_UNDEFINED} )
+
+    target_link_libraries(amarok -Wl,-whole-archive ${MYSQL_EMBEDDED_LIBRARIES} -Wl,-no-whole-archive)
+    if(NOT WIN32)
+        if(NOT APPLE)
+            target_link_libraries(amarok crypt pthread dl ssl)
+        endif(NOT APPLE)
+    endif(NOT WIN32)
+    set_target_properties(amarok PROPERTIES LINK_FLAGS "-Wl,--allow-multiple-definition")
 
     install(TARGETS amarok ${INSTALL_TARGETS_DEFAULT_ARGS})
 endif(Q_WS_MAC)
diff --git a/src/core-impl/collections/sqlcollection/mysqlecollection/CMakeLists.txt b/src/core-impl/collections/sqlcollection/mysqlecollection/CMakeLists.txt
index aa3588c..0a25e0e 100644
--- a/src/core-impl/collections/sqlcollection/mysqlecollection/CMakeLists.txt
+++ b/src/core-impl/collections/sqlcollection/mysqlecollection/CMakeLists.txt
@@ -27,6 +27,9 @@ SET(CMAKE_SHARED_LINKER_FLAGS ${CMAKE_SHARED_LINKER_FLAGS_NOFATALWARN} )
 STRING(REPLACE "-Wl,--fatal-warnings" "" CMAKE_MODULE_LINKER_FLAGS_NOFATALWARN ${CMAKE_MODULE_LINKER_FLAGS})
 SET(CMAKE_MODULE_LINKER_FLAGS ${CMAKE_MODULE_LINKER_FLAGS_NOFATALWARN} )
 
+STRING(REPLACE "-Wl,--no-undefined" "" CMAKE_MODULE_LINKER_FLAGS_ALLOW_UNDEFINED ${CMAKE_MODULE_LINKER_FLAGS})
+SET(CMAKE_MODULE_LINKER_FLAGS ${CMAKE_MODULE_LINKER_FLAGS_ALLOW_UNDEFINED} )
+
 target_link_libraries(amarok_collection-mysqlecollection
     amarok-sqlcollection
     amarokcore
@@ -34,15 +37,8 @@ target_link_libraries(amarok_collection-mysqlecollection
     ${KDE4_KDECORE_LIBS}
     ${QT_QTCORE_LIBRARY}
     ${QT_QTGUI_LIBRARY}
-    ${MYSQL_EMBEDDED_LIBRARIES}
-    ${CMAKE_DL_LIBS}
-    ${ZLIB_LIBRARIES}
 )
 
-if(NOT WIN32 AND NOT APPLE)
-    target_link_libraries( amarok_collection-mysqlecollection crypt pthread )
-endif(NOT WIN32 AND NOT APPLE)
-
 if(APPLE)
 	SET_TARGET_PROPERTIES(amarok_collection-mysqlecollection PROPERTIES LINK_FLAGS "-undefined dynamic_lookup")
 endif(APPLE)
-- 
1.7.1

