# Copyright 2008 Ingmar Vanhassel <ingmar@exherbo.org>
# Distributed under the terms of the GNU General Public License v2
# Based in part upon 'soprano-2.0.2.ebuild' from Gentoo, which is:
#     Copyright 1999-2008 Gentoo Foundation.

require cmake

SUMMARY="Soprano is a library which provides a nice Qt interface to RDF storage solutions."
DESCRIPTION='
Soprano (formerly known as QRDF) is a library which provides a highly usable
object-oriented C++/QT4 framework for RDF data. It uses different RDF storage
solutions as backends through a simple plugin system. Soprano is targetted at
desktop applications that need a RDF data storage solution. It has been
optimized for easy usage and simplicity.
'
HOMEPAGE="http://sourceforge.net/projects/soprano"
DOWNLOADS="mirror://sourceforge/${PN}/${PNV}.tar.bz2"

LICENCES="GPL-2 LGPL-2.1"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="doc"

DEPENDENCIES="
    build:
        doc? ( app-doc/doxygen )
    build+run:
        >=dev-cpp/clucene-0.9.19
        >=dev-libs/rasqal-0.9.15
        >=dev-libs/redland-1.0.6[berkdb]
        >=media-libs/raptor-1.4.16
        x11-libs/qt:4[dbus]"

# Tests fail for out-of-source build
ECMAKE_BUILD_TYPE="in-source"
# Tests failing because Sesame2 can't properly be disabled in the CMake buildsystem:
# FIXME: Send patch upstream
#   redlandmultithreadtest indexmodelmultithreadingtest localsocketmultithreadtest sopranodbusmultithreadtest
# Real test failures:
#   sopranodclienttest sopranodsocketclienttest sopranodbusclienttest
RESTRICT=test

src_prepare() {
    if option !doc; then
        sed -e '/find_package(Doxygen)/s/^/#DONOTFIND /' \
            -i "${WORK}"/CMakeLists.txt || die 'Doxygen sed failed.'
    fi
    sed -e '/find_package(JNI)/s/^/#DONOTFIND /' \
        -i "${WORK}"/CMakeLists.txt || die 'Java/Sesame2 sed failed.'
}

